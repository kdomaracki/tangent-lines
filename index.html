<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tangent Line Visualizer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f9f9f9; }
        #container { max-width: 700px; margin: auto; background: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 2px 12px #0001; }
        canvas { background: #fff; border: 1px solid #ccc; display: block; margin: 0 auto 24px auto; }
        .slider-container { display: flex; align-items: center; gap: 12px; justify-content: center; }
        .slider-container label { font-weight: bold; }
    </style>
</head>
<body>
    <div id="container">
        <h2>Tangent Line to f(x) = x² + 10</h2>
        <canvas id="plot" width="600" height="400" style="touch-action:none; cursor:pointer;"></canvas>
        <div class="slider-container">
            <label for="x0">x₀:</label>
            <input type="range" id="x0" min="-10" max="10" step="0.01" value="0">
            <span id="x0-value">0.00</span>
        </div>
    </div>
    <script>
        // Function and its derivative
        function f(x) { return x * x + 10; }
        function df(x) { return 2 * x; }

        const canvas = document.getElementById('plot');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        // Plot settings
        const xMin = -10, xMax = 10;
        const yMin = 0, yMax = 120;

        function xToPx(x) {
            return (x - xMin) / (xMax - xMin) * width;
        }
        function yToPx(y) {
            return height - (y - yMin) / (yMax - yMin) * height;
        }

        function pxToX(px) {
            return xMin + (xMax - xMin) * px / width;
        }

        function drawAxes() {
            ctx.save();
            ctx.strokeStyle = '#bbb';
            ctx.lineWidth = 1;
            // x-axis
            ctx.beginPath();
            ctx.moveTo(xToPx(xMin), yToPx(0));
            ctx.lineTo(xToPx(xMax), yToPx(0));
            ctx.stroke();
            // y-axis
            ctx.beginPath();
            ctx.moveTo(xToPx(0), yToPx(yMin));
            ctx.lineTo(xToPx(0), yToPx(yMax));
            ctx.stroke();
            ctx.restore();
        }

        function drawCurve() {
            ctx.save();
            ctx.strokeStyle = '#1976d2';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let px = 0; px <= width; px++) {
                const x = xMin + (xMax - xMin) * px / width;
                const y = f(x);
                const py = yToPx(y);
                if (px === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();
            ctx.restore();
        }

        function drawTangent(x0) {
            const y0 = f(x0);
            const slope = df(x0);
            // Tangent line: y = slope*(x-x0) + y0
            // Draw tangent line across the plot
            const x1 = xMin, y1 = slope * (x1 - x0) + y0;
            const x2 = xMax, y2 = slope * (x2 - x0) + y0;
            ctx.save();
            ctx.strokeStyle = '#e53935';
            ctx.lineWidth = 2;
            ctx.setLineDash([6, 6]);
            ctx.beginPath();
            ctx.moveTo(xToPx(x1), yToPx(y1));
            ctx.lineTo(xToPx(x2), yToPx(y2));
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.restore();
        }

        function drawPoint(x0) {
            const y0 = f(x0);
            ctx.save();
            ctx.fillStyle = '#43a047';
            ctx.beginPath();
            ctx.arc(xToPx(x0), yToPx(y0), 7, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 2;
            ctx.stroke();
            // Draw label with coordinates
            ctx.font = 'bold 16px Arial';
            ctx.fillStyle = '#222';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'bottom';
            const label = `(${x0.toFixed(2)}, ${y0.toFixed(2)})`;
            let labelX = xToPx(x0) + 12;
            let labelY = yToPx(y0) - 12;
            // Keep label inside canvas
            if (labelX + 80 > width) labelX = xToPx(x0) - 80;
            if (labelY < 20) labelY = yToPx(y0) + 24;
            ctx.fillText(label, labelX, labelY);
            ctx.restore();
        }

        function drawSlope(x0) {
            const slope = df(x0);
            ctx.save();
            ctx.font = 'bold 22px Arial';
            ctx.fillStyle = '#e53935';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'top';
            const text = `Slope: ${slope.toFixed(2)}`;
            ctx.fillText(text, width - 20, 20);
            ctx.restore();
        }

        function render(x0) {
            ctx.clearRect(0, 0, width, height);
            drawAxes();
            drawCurve();
            drawTangent(x0);
            drawPoint(x0);
            drawSlope(x0);
        }

        // Slider logic
        const x0Slider = document.getElementById('x0');
        const x0Value = document.getElementById('x0-value');
        let x0 = parseFloat(x0Slider.value);
        function update(val) {
            if (typeof val === 'number') x0 = val;
            else x0 = parseFloat(x0Slider.value);
            x0Value.textContent = x0.toFixed(2);
            x0Slider.value = x0;
            render(x0);
        }
        x0Slider.addEventListener('input', update);

        // Drag logic
        let dragging = false;
        function isNearPoint(mx, my) {
            const px = xToPx(x0);
            const py = yToPx(f(x0));
            const dist = Math.sqrt((mx - px) ** 2 + (my - py) ** 2);
            return dist < 15;
        }
        canvas.addEventListener('mousedown', function(e) {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            const my = e.clientY - rect.top;
            if (isNearPoint(mx, my)) {
                dragging = true;
            }
        });
        canvas.addEventListener('mousemove', function(e) {
            if (!dragging) return;
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            let newX = pxToX(mx);
            // Clamp to slider range
            newX = Math.max(xMin, Math.min(xMax, newX));
            update(newX);
        });
        canvas.addEventListener('mouseup', function() { dragging = false; });
        canvas.addEventListener('mouseleave', function() { dragging = false; });

        // Touch events for mobile
        canvas.addEventListener('touchstart', function(e) {
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const mx = touch.clientX - rect.left;
            const my = touch.clientY - rect.top;
            if (isNearPoint(mx, my)) {
                dragging = true;
                e.preventDefault();
            }
        }, { passive: false });
        canvas.addEventListener('touchmove', function(e) {
            if (!dragging) return;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            let mx = touch.clientX - rect.left;
            let newX = pxToX(mx);
            newX = Math.max(xMin, Math.min(xMax, newX));
            update(newX);
            e.preventDefault();
        }, { passive: false });
        canvas.addEventListener('touchend', function() { dragging = false; });
        canvas.addEventListener('touchcancel', function() { dragging = false; });

        update();
    </script>
</body>
</html>
